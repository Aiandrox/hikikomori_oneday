<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8">
  <title>引きこもりの１日</title>
  <link rel="stylesheet" href="main.css">
</head>

<body>
  <div id="app">
    <h1>引きこもりの１日</h1>
    <div v-if="gameStatus === 'yet'">
      <div>
        名前:
        <input type="text" :value="name">
      </div>
      <div>
        起床時刻（5〜12時）:
        <input type="number" :value="getupTime" min="5" max="12">時
      </div>
      <button @click="startGame">起床</button>
    </div>
    <div v-if="gameStatus === 'moving'">
      <div>
        {{time}}時
      </div>
      <div>
        名前: {{name}}
      </div>
      <div>
        満腹感: {{status.satiety}}%
      </div>
      <div>
        排尿感: {{status.toilet}}%
      </div>
      <div>
        活動時間: {{activityTime}}時間
      </div>
      かしこさ: {{status.intelligence}}<br>
      たのしさ: {{status.fun}}<br>
      <div></div>
      <button v-for="(value, index) in actions" @click="action(index)">{{value.text}}</button>
      <button @click="setGame">就寝</button>

      <div>
        <div v-for="value in actionHistory">{{action.time}} {{action.action}}</div>
      </div>
    </div>
    <div v-if="gameStatus === 'finish'">
      <div v-show="flag">
        <h2>ゲームオーバー</h2>
        {{result.comment}}
      </div>
      <div v-show="!flag">
        <h2>おやすみなさい</h2>
        {{result.title}}<br>
        {{result.comment}}
        <div>
          かしこさ: {{status.intelligence}}<br>
          たのしさ: {{status.fun}}<br>
          活動時間: {{activityTime}}時間
        </div>
        <a href="#">活動記録を見る</a>
        <div>
          <table>
            <tr v-for="value in actionHistory">
              <th>{{value.time}}</th>
              <td>{{value.text}}</td>
            </tr>
          </table>
        </div>
      </div>
      <div>
        <a
          href="https://twitter.com/intent/tweet?text=てきすと&hashtags=ひきこもりの１日&url=https://aiandrox.github.io/hikikomori_oneday/">結果をTweetする</a>
        <button @click="resetGame">リトライ</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>
  <script>
    const app = new Vue({
      el: "#app",
      data: () => ({
        gameStatus: 'yet',
        name: '名無しさん',
        getupTime: 5,
        time: 0,
        flag: false,
        status: {
          satiety: 50,
          toilet: 50,
          intelligence: 20,
          fun: 0,
          sleep: 0,
        },
        actions: [
          { text: 'ご飯を食べる', satiety: 100, toilet: 0, intelligence: 0, fun: 10, sleep: 0 },
          { text: 'トイレに行く', satiety: 0, toilet: -100, intelligence: 0, fun: 0, sleep: 0 },
          { text: '勉強する', satiety: 0, toilet: 0, intelligence: 13, fun: 5, sleep: 0 },
          { text: 'ゲームする', satiety: 0, toilet: 0, intelligence: 5, fun: 10, sleep: 0 },
          { text: '昼寝する', satiety: 0, toilet: 0, intelligence: 3, fun: 5, sleep: 1 },
        ],
        actionHistory: [],
        result: {
          title: '',
          comment: '',
        }
      }),
      computed: {
        activityTime: function () {
          return this.time - this.getupTime - this.status.sleep
        },
        totalPoint: function () {
          const status = this.status
          const point = Math.floor((status.satiety + status.intelligence + status.fun) * 0.7)
          if (this.activityTime > 15) {
            return Math.floor(point * 0.8)
          }
          return point
        },
        tweetText: function () {
          return `${this.result.title} ${this.result.comment}`
        }
      },
      methods: {
        startGame: function () {
          if (confirm(`${this.name}は${this.getupTime}時に起きますか？\n（ゲームを開始します）`)) {
            this.gameStatus = 'moving'
            this.time = Number(this.getupTime)
          }
        },
        spendTime: function () {
          this.status.toilet += 10
          this.status.satiety -= 10
          this.time += 1
        },
        action: function (index) {
          const action = this.actions[index]
          this.actionHistory.push({ time: this.time + "時", text: action.text })
          this.spendTime()
          this.status.satiety += action.satiety
          this.status.toilet += action.toilet
          this.status.intelligence += this.randNum(action.intelligence)
          this.status.fun += this.randNum(action.fun)
          this.status.sleep += action.sleep
        },
        randNum: function (number) {
          if (number === 0) {
            return 0
          } else {
            min = number - 10
            return Math.floor(Math.random() * (number - min + 1) + min)
          }
        },
        setGame: function () {
          if (confirm("就寝しますか？\n（ゲームを終了します）")) {
            this.gameStatus = 'finish'
            this.result.title = `${this.name}の１日は${this.totalPoint}点でした。`
            this.setResultComment()
          }
        },
        number: function (actionText) {
          return this.actionHistory.filter((item, index) => {
            if (item.text === actionText) return true;
          }).length
        },
        setResultComment: function () {
          const comments = []
          const numberOfEat = this.number("ご飯を食べる")
          const numberOfToilet = this.number("トイレに行く")
          const numberOfStudy = this.number("勉強する")
          const numberOfGame = this.number("ゲームする")
          if (this.activityTime > 15) {
            comments.push("充実した１日でした。")
          } else if (this.status.sleep > 3) {
            comments.push("寝すぎです。")
          } else if (this.getupTime < 7 && 19 <= this.time && this.time <= 22) {
            comments.push("いい生活習慣です。")
          }
          if (numberOfStudy > 5) {
            comments.push("たくさん勉強をしました。")
          }
          if (numberOfGame > 5) {
            comments.push("たくさんゲームをしました。")
          }
          if (numberOfEat > 5) {
            comments.push("少しご飯を食べ過ぎです。")
          }
          if (numberOfToilet > 5) {
            comments.push("頻尿のようです。")
          }
          if (comments.length === 0) {
            comments.push("特に何も成し遂げずに１日を終えました。")
          }
          this.result.comment = comments.join('')
        },
        gameOver: function () {
          this.flag = true
          this.gameStatus = "finish"
          this.result.title = "ゲームオーバー"
        },
        resetGame: () => {
          Object.assign(app.$data, app.$options.data())
        }
      },
      watch: {
        'status.toilet': function () {
          if (this.status.toilet >= 100) {
            this.gameOver()
            this.result.comment = `${this.name}は粗相してしまいました。`
          } else if (this.status.toilet <= 0) {
            this.status.toilet = 0
          }
        },
        'status.satiety': function () {
          if (this.status.satiety >= 100) {
            this.status.satiety = 100
          } else if (this.status.satiety <= 0) {
            this.gameOver()
            this.result.comment = `${this.name}はお腹が空いて倒れてしまいました。`
          }
        },
        activityTime: function () {
          if (this.activityTime >= 20) {
            this.gameOver()
            this.result.comment = `${this.name}は疲れて眠ってしまいました。`
          }
        }
      }
    })
  </script>
</body>

</html>